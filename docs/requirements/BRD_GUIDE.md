# BRD作成ガイド（ローカル対話用）

この文書は、要件定義（BRD: Business Requirements Document）をローカル対話（Claude Codeなど）で作成するためのガイドです。技術実装の詳細ではなく「何を／なぜ」を明確にし、後続の設計・実装・テストへスムーズに引き継ぐことを目的とします。

- 原則
  - 技術固有の詳細はBRDへ記載しない（スタックやコマンドは docs/tech/* を参照）
  - 曖昧さを残さない。仮定で埋めず、疑問は質問として明示
  - 1機能 = 1つのH2セクション（後続でIssue化する単位になる）
  - 各機能には Acceptance Criteria（Given/When/Then、正常/異常）を最低1つずつ
  - スコープIn/Out・非機能（性能/可用性/セキュリティ/観測性など）・KPI・リスク・用語を含める

- 参照
  - テンプレート: docs/requirements/BRD_TEMPLATE.md
  - 技術スタック資料: docs/tech/stack_*.md（必要なら参考にするが、BRD本文へは記載しない）

---

## 1. 進め方（推奨）
1) 不明点の洗い出し（対話）
- 入力（背景/目的、スコープ、制約、機能の種、非機能、KPI）を聞き取り、曖昧・不足・矛盾を抽出
- 質問は「Yes/No」と「具体値」を分けて提示（例: 期限、SLO値、上限、閾値、対象規模、対応範囲など）
- 例:
  - Yes/No: 顧客はダッシュボードにログインして閲覧しますか？
  - 具体値: 同時利用者は何名想定ですか？レスポンスタイムのP95目標は？

2) BRDの骨子をテンプレートへ反映
- docs/requirements/BRD_TEMPLATE.md を複製し、タイトル・背景・目的・スコープIn/Outを埋める
- 機能（H2）を列挙し、各機能の Acceptance Criteria（正常/異常）を初期化

3) 非機能・KPI・リスク・用語を具体化
- 性能（例: P95<=3s）、可用性（稼働率99.9%）、セキュリティ（RBAC、Secrets外部化等）
- 観測性（トレースID、ログ連携）、バックアップ/保持、エクスポート上限など

4) 自動検証（任意）
- `python3 scripts/validate_brd.py --json` を実行し、形式要件を満たすまで修正

5) コミット＆プッシュ
- 完了したBRDは `docs/requirements/BRD.md` として保存しコミット
- 01 Plan Issues ワークフロー（手動または push トリガ）で Issue 化

---

## 2. 章立て要件（チェックリスト）
- [ ] H1: タイトルが1つ
- [ ] H2: 機能セクションが1つ以上
- [ ] 各H2に Acceptance Criteria（Given/When/Then）正常/異常を各1つ以上
- [ ] スコープ In/Out を明記
- [ ] 非機能要件（性能/可用性/セキュリティ/観測性/保持等）を具体値で記載
- [ ] KPI を数値化
- [ ] リスクと制約、用語集を含む
- [ ] 技術固有の詳細（フレームワーク名/コマンド等）は記載しない

---

## 3. Acceptance Criteria（書き方のコツ）
- Given（前提）/ When（操作）/ Then（期待結果）
- UI/外部I/Fに依存しない表現を心がける（業務上の事実が変わらなければ成り立つ）
- 異常系は代表的な拒否条件/権限逸脱/上限超過/重複/入力エラーなどを1つ以上

例（正常系）
- Given: 管理者が新規プロジェクトを作成
- When: プロジェクト名、顧客、テンプレートを入力して保存
- Then: プロジェクトが作成され、一覧で参照できる

例（異常系）
- Given: 10万件を超えるCSVをインポート
- When: アップロードを実行
- Then: 「上限を超えています」と表示し、登録されない

---

## 4. スコープ/非機能/観測性（ヒント）
- スコープIn: 初期に必須の機能／対象（例: ロール別認証、監査ログ、CSVエクスポート）
- スコープOut: 後回しにする機能（例: A/Bテスト、通知、スマホ最適化）
- 性能: P95の応答時間、スループット上限、エクスポート時間
- 可用性: 稼働率、バックアップ、保持期間
- セキュリティ: 認証/認可、Secrets外部化、入力検証、CSP/HTTPS
- 観測性: トレースID付与、ログ相関、例外扱い

---

## 5. よくある質問（FAQ）
- Q: 技術スタックをBRDに書いて良い？
  - A: いいえ。技術は docs/tech/* にまとめ、BRDはビジネス要件に限定
- Q: どの粒度でH2を切る？
  - A: 1機能=1H2（後続で1Issueに割り当てやすい粒度）
- Q: 数値が決められない場合は？
  - A: 仮値で置き、後続で調整。曖昧語は避け、レンジ・上限でもOK

---

## 6. Claude Code 向けプロンプト例
- 「docs/requirements/BRD_GUIDE.md を読み、与えた背景/目的/制約から、まず曖昧点の質問だけを列挙して。Yes/Noと具体値質問を分けること」
- 「質問の回答を踏まえて、docs/requirements/BRD_TEMPLATE.md を埋めて docs/requirements/BRD.md を出力して」
- 「`python3 scripts/validate_brd.py --json` のエラーを見て、形式要件を満たすまで最小修正」

