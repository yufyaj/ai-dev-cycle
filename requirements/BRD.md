# フォーム営業管理ツール

### 1. 背景と目的

### 1.1 背景
フォーム営業は、潜在顧客へのアプローチ手段として有効だが、複数のワーカーが並行して実施する際の進捗管理、実績集計、顧客への報告が煩雑になる課題がある。手作業での管理では、重複送信・未送信の発生、リアルタイムな進捗把握の困難、A/Bテスト効果測定の難しさが生じている。

### 1.2 目的
フォーム営業の実施から報告までを一元管理し、以下を実現する：
- ワーカーの作業効率向上（割り当てリストの明確化、実績入力の簡素化）
- 管理者の進捗把握・リソース配分の最適化
- 顧客へのリアルタイムな実績報告による透明性向上
- データに基づく営業戦略の改善（将来的なA/Bテスト対応含む）

### 1.3 ビジネス価値
- ワーカーの実績入力時間を50%削減
- 管理者の進捗確認作業を70%削減
- 顧客への報告リードタイムを即時化（従来：週次 → 目標：リアルタイム参照可能）

### 2. スコープ

#### 2.1 スコープIn（初期リリースに含む）
- ロール別認証（ワーカー/管理者/顧客）
- 管理者によるアカウント発行・無効化
- プロジェクト作成・編集・削除（論理削除）
- 営業リストの登録・管理（CSV一括インポート対応）
- ワーカーへのリスト項目割り当て
- ワーカーによる実績入力（送信日時・成否・メモ・返信フラグ）
- 管理者による進捗・実績確認
- 顧客ダッシュボード（手動リフレッシュ）
- CSV形式でのデータエクスポート
- 監査ログ・変更履歴の記録
- プロジェクト削除後のデータ保持（論理削除）

#### 2.2 スコープOut（初期リリースに含まない）
- 自動フォーム送信機能（送信自体はワーカーが手動実施）
- 返信内容のテキスト記録（フラグのみ、本文は対象外）
- A/Bテスト機能（将来対応予定）
- 通知機能（メール・Slack等）
- Excel/PDF形式でのエクスポート
- リアルタイム自動更新（WebSocket/ポーリング）
- 多言語対応（初期は日本語のみ）
- スマートフォン最適化（PC/タブレットのみ）

## 3. 認証・アカウント管理

### 3.1 概要
システムへのアクセスは、ロール別（ワーカー/管理者/顧客）に認証・認可を行う。アカウントは管理者が発行・管理する。

### 3.2 機能要件
- ログイン画面（メールアドレス + パスワード）
- ロール別の画面・機能制限
- 管理者によるアカウント新規発行（ワーカー/顧客）
- 管理者によるアカウント無効化・削除
- セッション管理（無操作1時間で自動ログアウト）
- パスワード変更機能

### 3.3 Acceptance Criteria

#### 正常系
- **Given**: 管理者が顧客アカウントを新規発行する操作を実施
- **When**: 有効なメールアドレスとロール（顧客）を指定
- **Then**: アカウントが作成され、初回ログイン用の認証情報が発行される

#### 異常系
- **Given**: 既に登録済みのメールアドレスでアカウント発行を試行
- **When**: 管理者が重複するメールアドレスを入力
- **Then**: エラーメッセージ「このメールアドレスは既に使用されています」が表示され、アカウントは作成されない

## 4. プロジェクト管理

### 4.1 概要
管理者がフォーム営業の単位となるプロジェクトを作成・管理する。各プロジェクトには顧客を紐づけ、送信文章テンプレートを設定する。

### 4.2 機能要件
- プロジェクト新規作成（プロジェクト名、顧客紐づけ、送信文章テンプレート）
- プロジェクト編集（名称・テンプレート変更）
- プロジェクト削除（論理削除、実績データは保持）
- 1プロジェクトに対し1顧客を紐づけ（基本）、複数顧客の紐づけも可能
- 送信文章テンプレートの登録・編集

### 4.3 Acceptance Criteria

#### 正常系
- **Given**: 管理者が新規プロジェクトを作成
- **When**: プロジェクト名「○○社向けキャンペーン」、顧客「○○社」、送信文章テンプレートを入力
- **Then**: プロジェクトが作成され、管理者・紐づけ顧客がプロジェクト一覧で参照可能になる

#### 異常系
- **Given**: プロジェクト削除を実施
- **When**: 管理者が削除ボタンを押下
- **Then**: プロジェクトは論理削除され、一覧には表示されないが、過去の実績データは保持される

## 5. 営業リスト管理

### 5.1 概要
管理者が営業先リストを登録・管理し、ワーカーに割り当てる。リストはプロジェクト配下に複数作成可能で、各リスト内の項目を選択してワーカーに割り当てる。

### 5.2 機能要件
- 1プロジェクト配下に複数のリストを作成可能
- リスト項目の手動登録（企業名、担当者名、フォームURL、メモ）
- リスト項目のCSV一括インポート（最大10万件/プロジェクト）
- リスト項目のワーカーへの割り当て（複数ワーカーへの重複割り当て可能）
- 割り当て解除・再割り当て
- リスト項目のステータス管理（未着手/実施中/完了/返信あり）

### 5.3 Acceptance Criteria

#### 正常系
- **Given**: 管理者が5000件の営業先を含むCSVをアップロード
- **When**: CSVフォーマットが正しく、プロジェクトの上限（10万件）以内
- **Then**: 5000件のリスト項目が登録され、管理画面で一覧表示される

#### 異常系
- **Given**: 管理者が10万件を超えるCSVをアップロード
- **When**: CSVに11万件のレコードが含まれる
- **Then**: エラーメッセージ「1プロジェクトあたりのリスト上限（10万件）を超えています」が表示され、インポートが中止される

## 6. ワーカー実績入力

### 6.1 概要
ワーカーが割り当てられたリスト項目を参照し、フォーム送信後の実績を入力する。

### 6.2 機能要件
- 自分に割り当てられたリスト項目のみ閲覧可能
- リスト項目詳細表示（企業名、担当者、フォームURL、送信文章テンプレート）
- 実績入力（送信日時、成功/失敗、メモ、返信フラグ）
- ステータス更新（未着手→実施中→完了）
- 実績の編集（誤入力の修正）

### 6.3 Acceptance Criteria

#### 正常系
- **Given**: ワーカーが割り当てられたリスト項目の実績を入力
- **When**: 送信日時「2025-10-19 14:30」、成功、メモ「担当者不在のため再送」を入力
- **Then**: 実績が保存され、ステータスが「完了」に更新される

#### 異常系
- **Given**: ワーカーが他のワーカーに割り当てられたリスト項目にアクセス
- **When**: 直接URLでアクセスを試行
- **Then**: 403エラーが表示され、アクセスが拒否される

## 7. 進捗・実績管理

### 7.1 概要
管理者がプロジェクト全体およびワーカー別の進捗・実績を確認する。

### 7.2 機能要件
- プロジェクト別サマリー表示（総件数、完了件数、返信件数、完了率）
- ワーカー別進捗表示（担当件数、完了件数、完了率）
- リスト項目詳細検索・フィルタ（ステータス、ワーカー、期間）
- 返信フラグの登録・更新
- 実績データのCSVエクスポート（最大10万件）

### 7.3 Acceptance Criteria

#### 正常系
- **Given**: 管理者がプロジェクトの実績データをエクスポート
- **When**: 「2025年10月」の期間で5000件のデータを選択
- **Then**: 5000件を含むCSVファイルがダウンロードされる

#### 異常系
- **Given**: 管理者が10万件を超えるデータをエクスポート
- **When**: 11万件のデータを選択してエクスポート実行
- **Then**: エラーメッセージ「エクスポート上限（10万件）を超えています。期間を絞ってください」が表示される

## 8. 顧客ダッシュボード

### 8.1 概要
顧客が自社のプロジェクトの進捗・実績をリアルタイムで確認する。

### 8.2 機能要件
- 紐づけられたプロジェクトのサマリー表示（総件数、完了件数、返信件数、完了率）
- グラフ表示（日別の完了推移、返信率推移）
- 手動リフレッシュボタン
- 実績データのCSVエクスポート（最大10万件）

### 8.3 Acceptance Criteria

#### 正常系
- **Given**: 顧客がダッシュボードにアクセス
- **When**: 紐づけられたプロジェクトが1件存在し、完了率が60%
- **Then**: サマリーに「総件数: 1000件、完了: 600件、返信: 50件、完了率: 60%」が表示される

#### 異常系
- **Given**: 顧客が紐づけられていないプロジェクトにアクセス
- **When**: 直接URLでアクセスを試行
- **Then**: 403エラーが表示され、アクセスが拒否される

## 9. 監査ログ・変更履歴

### 9.1 概要
システム内の重要な操作を記録し、トレーサビリティを確保する。

### 9.2 機能要件
- 以下の操作を記録：
  - アカウントの作成・無効化（実施者、対象、日時）
  - プロジェクトの作成・編集・削除（実施者、プロジェクト名、日時）
  - リストの登録・編集・割り当て変更（実施者、対象リスト、日時）
  - 実績の入力・編集（ワーカー、対象リスト項目、日時）
- 管理者による監査ログ閲覧（検索・フィルタ機能）
- ログ保持期間：無期限

### 9.3 Acceptance Criteria

#### 正常系
- **Given**: 管理者がプロジェクトの送信文章テンプレートを編集
- **When**: 変更を保存
- **Then**: 監査ログに「管理者A、プロジェクト「○○社向けキャンペーン」のテンプレートを編集、2025-10-19 15:00」が記録される

#### 異常系
- **Given**: ワーカーが監査ログ画面にアクセス
- **When**: 直接URLでアクセスを試行
- **Then**: 403エラーが表示され、アクセスが拒否される（監査ログは管理者のみ閲覧可能）

### 10. 非機能要件

#### 10.1 性能・スケーラビリティ
- **レスポンスタイム**: 全操作で3秒以内（P95）
- **同時接続数**: ワーカー50名、管理者5名、顧客10名の同時接続を想定（合計65名）
- **スループット**: 1プロジェクトあたり最大10万件のリスト項目を管理可能
- **エクスポート**: 10万件のCSVエクスポートを5分以内に完了

#### 10.2 可用性・信頼性
- **稼働率**: 99.9%（年間ダウンタイム8.76時間以内）
- **バックアップ**: 日次バックアップ、保持期間30日
- **データ保持**: 実績データは無期限保持（プロジェクト削除後も論理削除で保持）

#### 10.3 セキュリティ
- **認証**: パスワードはハッシュ化して保存
- **認可**: ロールベースアクセス制御（RBAC）
- **セッション**: 無操作1時間で自動ログアウト
- **通信**: HTTPS必須
- **CSP**: Content Security Policyを有効化
- **入力検証**: XSS/SQLインジェクション対策

#### 10.4 可観測性
- **ログ**: 全リクエストに一意のトレースIDを付与
- **エラー追跡**: サーバー側エラーログの記録
- **監査**: 重要操作の監査ログ記録（10.9参照）

#### 10.5 ユーザビリティ
- **対応デバイス**: PC（Windows/Mac）、タブレット（iPad等）
- **対応ブラウザ**: Chrome最新版、Edge最新版、Safari最新版
- **言語**: 日本語のみ

#### 10.6 アーキテクチャ設計方針
- **責務分離**: UI層は表示と最小限の入力検証、BFF層は中継・認証・軽微な整形のみ、ビジネスロジックはサーバー側に集約
- **依存方向**: UI→BFF→アプリケーション層→ドメイン層（内向き依存）
- **テスト**: TDD原則、全PRに正常系・異常系テストを含む

### 11. KPI

#### 11.1 ビジネスKPI
- ワーカーの実績入力時間：平均2分/件以下
- 管理者の進捗確認時間：週次1時間以下
- 顧客の報告リードタイム：即時（手動リフレッシュで最新データ参照可能）

#### 11.2 システムKPI
- 稼働率：99.9%以上
- レスポンスタイム（P95）：3秒以内
- エラー発生率：1%以下

### 12. リスクと制約

#### 12.1 リスク
- **大量データインポート時のタイムアウト**: 10万件のCSVインポートが3秒以内に完了しない可能性 → バックグラウンド処理・進捗表示で対応
- **ワーカー変更時のデータ整合性**: 同一リスト項目を複数ワーカーに割り当てた場合の実績の扱い → 最新の実績を優先、履歴は監査ログで追跡
- **顧客の複数プロジェクト参照**: 複数顧客が同一プロジェクトを参照する場合の権限管理 → プロジェクト-顧客の多対多関連をサポート

#### 12.2 制約
- 送信自体は手動（自動送信機能は対象外）
- 返信内容のテキスト本文は記録しない（フラグのみ）
- 初期リリースでは通知機能なし

### 13. 用語集

| 用語 | 定義 |
|------|------|
| プロジェクト | フォーム営業の実施単位。顧客と紐づけられ、営業リストと送信文章テンプレートを持つ |
| リスト | プロジェクト配下に作成される営業先のグループ。1プロジェクトに複数存在可能 |
| リスト項目 | リスト内の個別の営業先（企業名、担当者、フォームURL等を含む） |
| ワーカー | フォーム送信を実施し、実績を入力する役割 |
| 管理者 | プロジェクト・リスト・アカウントを管理する役割 |
| 顧客 | フォーム営業を依頼する側。進捗・実績を閲覧する役割 |
| 送信文章テンプレート | プロジェクト毎に設定される、フォームに入力する文章の雛形 |
| 実績 | ワーカーがフォーム送信後に入力する記録（送信日時、成否、メモ、返信フラグ） |
| 返信フラグ | 営業先から返信があったかを示すフラグ（あり/なし） |
| 論理削除 | データベースから物理削除せず、削除フラグを立てて非表示にする処理 |
| 監査ログ | システム内の重要操作を記録したログ（誰が、いつ、何を実施したか） |
| RBAC | Role-Based Access Control（ロールベースアクセス制御）の略 |
